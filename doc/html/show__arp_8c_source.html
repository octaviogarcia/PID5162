<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ETH: show_arp.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ETH
   </div>
   <div id="projectbrief">MOL ETH DRIVER</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('show__arp_8c_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">show_arp.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="show__arp_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &lt;sys/socket.h&gt;</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;sys/time.h&gt;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;asm/types.h&gt;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;math.h&gt;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;unistd.h&gt;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;signal.h&gt;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;linux/if_packet.h&gt;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;linux/if_ether.h&gt;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;linux/if_arp.h&gt;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno"><a class="line" href="show__arp_8c.html#a90d0f41f155e4b4ff63fda7627ac550c">   18</a></span>&#160;<span class="preprocessor">#define PROTO_ARP 0x0806</span></div><div class="line"><a name="l00019"></a><span class="lineno"><a class="line" href="show__arp_8c.html#a9980fa59d6dce6b7e044ca6fc19b0936">   19</a></span>&#160;<span class="preprocessor">#define ETH2_HEADER_LEN 14</span></div><div class="line"><a name="l00020"></a><span class="lineno"><a class="line" href="show__arp_8c.html#a364a315109bb526f2f773b5c4695e76b">   20</a></span>&#160;<span class="preprocessor">#define HW_TYPE 1</span></div><div class="line"><a name="l00021"></a><span class="lineno"><a class="line" href="show__arp_8c.html#aebe97308412c97831f443fb38699c946">   21</a></span>&#160;<span class="preprocessor">#define PROTOCOL_TYPE 0x800</span></div><div class="line"><a name="l00022"></a><span class="lineno"><a class="line" href="show__arp_8c.html#ac941b6796b26d46622ba39ad70667ed3">   22</a></span>&#160;<span class="preprocessor">#define MAC_LENGTH 6</span></div><div class="line"><a name="l00023"></a><span class="lineno"><a class="line" href="show__arp_8c.html#a9935c761f5e47454f667f0d5e4208e89">   23</a></span>&#160;<span class="preprocessor">#define IPV4_LENGTH 4</span></div><div class="line"><a name="l00024"></a><span class="lineno"><a class="line" href="show__arp_8c.html#a7a7c46ffaba30477b8c9e3e61bd2e106">   24</a></span>&#160;<span class="preprocessor">#define ARP_REQUEST 0x01</span></div><div class="line"><a name="l00025"></a><span class="lineno"><a class="line" href="show__arp_8c.html#a06ba7b414e718081998f2814090debf1">   25</a></span>&#160;<span class="preprocessor">#define ARP_REPLY 0x02</span></div><div class="line"><a name="l00026"></a><span class="lineno"><a class="line" href="show__arp_8c.html#a6821bafc3c88dfb2e433a095df9940c6">   26</a></span>&#160;<span class="preprocessor">#define BUF_SIZE 60</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="structarp__header.html">   28</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structarp__header.html">arp_header</a></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;{</div><div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="structarp__header.html#a26f790af15777120447eddb59c15bc7d">   30</a></span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="structarp__header.html#a26f790af15777120447eddb59c15bc7d">hardware_type</a>;</div><div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="structarp__header.html#a24dd89b1e5b9c31d4c2655df0d838673">   31</a></span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="structarp__header.html#a24dd89b1e5b9c31d4c2655df0d838673">protocol_type</a>;</div><div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="structarp__header.html#a63496664c0728baa8b8f213864290325">   32</a></span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structarp__header.html#a63496664c0728baa8b8f213864290325">hardware_len</a>;</div><div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="structarp__header.html#a199abced9d3b3367a4ed4125e63ce9d4">   33</a></span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>  <a class="code" href="structarp__header.html#a199abced9d3b3367a4ed4125e63ce9d4">protocol_len</a>;</div><div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="structarp__header.html#a8c0824ace997e9dda49fb5116a02fc65">   34</a></span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="structarp__header.html#a8c0824ace997e9dda49fb5116a02fc65">opcode</a>;</div><div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="structarp__header.html#abb59a40a80872088400763e1fd6acaf2">   35</a></span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structarp__header.html#abb59a40a80872088400763e1fd6acaf2">sender_mac</a>[<a class="code" href="show__arp_8c.html#ac941b6796b26d46622ba39ad70667ed3">MAC_LENGTH</a>];</div><div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="structarp__header.html#acf457b77e1ea289ae333fd2287954758">   36</a></span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structarp__header.html#acf457b77e1ea289ae333fd2287954758">sender_ip</a>[<a class="code" href="show__arp_8c.html#a9935c761f5e47454f667f0d5e4208e89">IPV4_LENGTH</a>];</div><div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="structarp__header.html#a3b66dfb45363fee0dc6e5e1a6d6c5156">   37</a></span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structarp__header.html#a3b66dfb45363fee0dc6e5e1a6d6c5156">target_mac</a>[<a class="code" href="show__arp_8c.html#ac941b6796b26d46622ba39ad70667ed3">MAC_LENGTH</a>];</div><div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="structarp__header.html#a7357fb5e2df0b32e297caf95618fcc73">   38</a></span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structarp__header.html#a7357fb5e2df0b32e297caf95618fcc73">target_ip</a>[<a class="code" href="show__arp_8c.html#a9935c761f5e47454f667f0d5e4208e89">IPV4_LENGTH</a>];</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;};</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="show__arp_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">   41</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="show__arp_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>()</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;{</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        <span class="keywordtype">int</span> sd;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buffer[<a class="code" href="show__arp_8c.html#a6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a>];</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> source_ip[4] = {10,222,190,160};</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structarp__header.html#a7357fb5e2df0b32e297caf95618fcc73">target_ip</a>[4] = {10,222,190,139};</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        <span class="keyword">struct </span>ifreq ifr;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        <span class="keyword">struct </span>ethhdr *send_req = (<span class="keyword">struct </span>ethhdr *)buffer;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        <span class="keyword">struct </span>ethhdr *rcv_resp= (<span class="keyword">struct </span>ethhdr *)buffer;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <span class="keyword">struct </span><a class="code" href="structarp__header.html">arp_header</a> *arp_req = (<span class="keyword">struct </span><a class="code" href="structarp__header.html">arp_header</a> *)(buffer+<a class="code" href="show__arp_8c.html#a9980fa59d6dce6b7e044ca6fc19b0936">ETH2_HEADER_LEN</a>);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        <span class="keyword">struct </span><a class="code" href="structarp__header.html">arp_header</a> *arp_resp = (<span class="keyword">struct </span><a class="code" href="structarp__header.html">arp_header</a> *)(buffer+<a class="code" href="show__arp_8c.html#a9980fa59d6dce6b7e044ca6fc19b0936">ETH2_HEADER_LEN</a>);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        <span class="keyword">struct </span>sockaddr_ll socket_address;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        <span class="keywordtype">int</span> index,ret,length=0,ifindex;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;memset(buffer,0x00,60);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        <span class="comment">/*open socket*/</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        sd = socket(AF_PACKET, SOCK_RAW, htons(ETH_P_ALL));</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <span class="keywordflow">if</span> (sd == -1) {</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                perror(<span class="stringliteral">&quot;socket():&quot;</span>);</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                exit(1);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        }</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        strcpy(ifr.ifr_name,<span class="stringliteral">&quot;eth1.30&quot;</span>);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="comment">/*retrieve ethernet interface index*/</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordflow">if</span> (ioctl(sd, SIOCGIFINDEX, &amp;ifr) == -1) {</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        perror(<span class="stringliteral">&quot;SIOCGIFINDEX&quot;</span>);</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        exit(1);</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    }</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    ifindex = ifr.ifr_ifindex;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;printf(<span class="stringliteral">&quot;interface index is %d\n&quot;</span>,ifindex);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="comment">/*retrieve corresponding MAC*/</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="keywordflow">if</span> (ioctl(sd, SIOCGIFHWADDR, &amp;ifr) == -1) {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                perror(<span class="stringliteral">&quot;SIOCGIFINDEX&quot;</span>);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                exit(1);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        }</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;close (sd);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <span class="keywordflow">for</span> (index = 0; index &lt; 6; index++)</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        {</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                send_req-&gt;h_dest[index] = (<span class="keywordtype">unsigned</span> char)0xff;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                arp_req-&gt;<a class="code" href="structarp__header.html#a3b66dfb45363fee0dc6e5e1a6d6c5156">target_mac</a>[index] = (<span class="keywordtype">unsigned</span> char)0x00;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                <span class="comment">/* Filling the source  mac address in the header*/</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                send_req-&gt;h_source[index] = (<span class="keywordtype">unsigned</span> char)ifr.ifr_hwaddr.sa_data[index];</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                arp_req-&gt;<a class="code" href="structarp__header.html#abb59a40a80872088400763e1fd6acaf2">sender_mac</a>[index] = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)ifr.ifr_hwaddr.sa_data[index];</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                socket_address.sll_addr[index] = (<span class="keywordtype">unsigned</span> char)ifr.ifr_hwaddr.sa_data[index];</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        }</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        printf(<span class="stringliteral">&quot;Successfully got eth1 MAC address: %02X:%02X:%02X:%02X:%02X:%02X\n&quot;</span>,</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                        send_req-&gt;h_source[0],send_req-&gt;h_source[1],send_req-&gt;h_source[2],</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                        send_req-&gt;h_source[3],send_req-&gt;h_source[4],send_req-&gt;h_source[5]);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        printf(<span class="stringliteral">&quot; arp_reqMAC address: %02X:%02X:%02X:%02X:%02X:%02X\n&quot;</span>,</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                        arp_req-&gt;<a class="code" href="structarp__header.html#abb59a40a80872088400763e1fd6acaf2">sender_mac</a>[0],arp_req-&gt;<a class="code" href="structarp__header.html#abb59a40a80872088400763e1fd6acaf2">sender_mac</a>[1],arp_req-&gt;<a class="code" href="structarp__header.html#abb59a40a80872088400763e1fd6acaf2">sender_mac</a>[2],</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                        arp_req-&gt;<a class="code" href="structarp__header.html#abb59a40a80872088400763e1fd6acaf2">sender_mac</a>[3],arp_req-&gt;<a class="code" href="structarp__header.html#abb59a40a80872088400763e1fd6acaf2">sender_mac</a>[4],arp_req-&gt;<a class="code" href="structarp__header.html#abb59a40a80872088400763e1fd6acaf2">sender_mac</a>[5]);</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        printf(<span class="stringliteral">&quot;socket_address MAC address: %02X:%02X:%02X:%02X:%02X:%02X\n&quot;</span>,</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                        socket_address.sll_addr[0],socket_address.sll_addr[1],socket_address.sll_addr[2],</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                        socket_address.sll_addr[3],socket_address.sll_addr[4],socket_address.sll_addr[5]);</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        <span class="comment">/*prepare sockaddr_ll*/</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        socket_address.sll_family = AF_PACKET;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        socket_address.sll_protocol = htons(ETH_P_ARP);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        socket_address.sll_ifindex = ifindex;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        socket_address.sll_hatype = htons(ARPHRD_ETHER);</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        socket_address.sll_pkttype = (PACKET_BROADCAST);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        socket_address.sll_halen = <a class="code" href="show__arp_8c.html#ac941b6796b26d46622ba39ad70667ed3">MAC_LENGTH</a>;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        socket_address.sll_addr[6] = 0x00;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        socket_address.sll_addr[7] = 0x00;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="comment">/* Setting protocol of the packet */</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        send_req-&gt;h_proto = htons(ETH_P_ARP);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="comment">/* Creating ARP request */</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        arp_req-&gt;<a class="code" href="structarp__header.html#a26f790af15777120447eddb59c15bc7d">hardware_type</a> = htons(<a class="code" href="show__arp_8c.html#a364a315109bb526f2f773b5c4695e76b">HW_TYPE</a>);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        arp_req-&gt;<a class="code" href="structarp__header.html#a24dd89b1e5b9c31d4c2655df0d838673">protocol_type</a> = htons(ETH_P_IP);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        arp_req-&gt;<a class="code" href="structarp__header.html#a63496664c0728baa8b8f213864290325">hardware_len</a> = <a class="code" href="show__arp_8c.html#ac941b6796b26d46622ba39ad70667ed3">MAC_LENGTH</a>;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        arp_req-&gt;<a class="code" href="structarp__header.html#a199abced9d3b3367a4ed4125e63ce9d4">protocol_len</a> =<a class="code" href="show__arp_8c.html#a9935c761f5e47454f667f0d5e4208e89">IPV4_LENGTH</a>;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        arp_req-&gt;<a class="code" href="structarp__header.html#a8c0824ace997e9dda49fb5116a02fc65">opcode</a> = htons(<a class="code" href="show__arp_8c.html#a7a7c46ffaba30477b8c9e3e61bd2e106">ARP_REQUEST</a>);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="keywordflow">for</span>(index=0;index&lt;5;index++)</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        {</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                arp_req-&gt;<a class="code" href="structarp__header.html#acf457b77e1ea289ae333fd2287954758">sender_ip</a>[index]=(<span class="keywordtype">unsigned</span> char)source_ip[index];</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                arp_req-&gt;<a class="code" href="structarp__header.html#a7357fb5e2df0b32e297caf95618fcc73">target_ip</a>[index]=(<span class="keywordtype">unsigned</span> char)target_ip[index];</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        }</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="comment">// Submit request for a raw socket descriptor.</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="keywordflow">if</span> ((sd = socket (PF_PACKET, SOCK_RAW, htons (ETH_P_ALL))) &lt; 0) {</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    perror (<span class="stringliteral">&quot;socket() failed &quot;</span>);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    exit (EXIT_FAILURE);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  }</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;buffer[32]=0x00;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        ret = sendto(sd, buffer, 42, 0, (<span class="keyword">struct</span>  sockaddr*)&amp;socket_address, <span class="keyword">sizeof</span>(socket_address));</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="keywordflow">if</span> (ret == -1)</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        {</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                perror(<span class="stringliteral">&quot;sendto():&quot;</span>);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                exit(1);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        }</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        {</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                printf(<span class="stringliteral">&quot; Sent the ARP REQ \n\t&quot;</span>);</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                <span class="keywordflow">for</span>(index=0;index&lt;42;index++)</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                {</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                        printf(<span class="stringliteral">&quot;%02X &quot;</span>,buffer[index]);</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                        <span class="keywordflow">if</span>(index % 16 ==0 &amp;&amp; index !=0)</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                        {printf(<span class="stringliteral">&quot;\n\t&quot;</span>);}</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                }</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        }</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;printf(<span class="stringliteral">&quot;\n\t&quot;</span>);</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        memset(buffer,0x00,60);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keywordflow">while</span>(1)</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                length = recvfrom(sd, buffer, <a class="code" href="show__arp_8c.html#a6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a>, 0, NULL, NULL);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                <span class="keywordflow">if</span> (length == -1)</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                {</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                        perror(<span class="stringliteral">&quot;recvfrom():&quot;</span>);</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                        exit(1);</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                }</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                <span class="keywordflow">if</span>(htons(rcv_resp-&gt;h_proto) == <a class="code" href="show__arp_8c.html#a90d0f41f155e4b4ff63fda7627ac550c">PROTO_ARP</a>)</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                {</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                        <span class="comment">//if( arp_resp-&gt;opcode == ARP_REPLY )</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                        printf(<span class="stringliteral">&quot; RECEIVED ARP RESP len=%d \n&quot;</span>,length);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                        printf(<span class="stringliteral">&quot; Sender IP :&quot;</span>);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                        <span class="keywordflow">for</span>(index=0;index&lt;4;index++)</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                                printf(<span class="stringliteral">&quot;%u.&quot;</span>,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)arp_resp-&gt;<a class="code" href="structarp__header.html#acf457b77e1ea289ae333fd2287954758">sender_ip</a>[index]);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                        printf(<span class="stringliteral">&quot;\n Sender MAC :&quot;</span>);</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                        <span class="keywordflow">for</span>(index=0;index&lt;6;index++)</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                                printf(<span class="stringliteral">&quot; %02X:&quot;</span>,arp_resp-&gt;<a class="code" href="structarp__header.html#abb59a40a80872088400763e1fd6acaf2">sender_mac</a>[index]);</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                        printf(<span class="stringliteral">&quot;\nReceiver  IP :&quot;</span>);</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                        <span class="keywordflow">for</span>(index=0;index&lt;4;index++)</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                                printf(<span class="stringliteral">&quot; %u.&quot;</span>,arp_resp-&gt;<a class="code" href="structarp__header.html#a7357fb5e2df0b32e297caf95618fcc73">target_ip</a>[index]);</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                        printf(<span class="stringliteral">&quot;\n Self MAC :&quot;</span>);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                        <span class="keywordflow">for</span>(index=0;index&lt;6;index++)</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                                printf(<span class="stringliteral">&quot; %02X:&quot;</span>,arp_resp-&gt;<a class="code" href="structarp__header.html#a3b66dfb45363fee0dc6e5e1a6d6c5156">target_mac</a>[index]);</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                        printf(<span class="stringliteral">&quot;\n  :&quot;</span>);</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                }</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        }</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;}</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;Thanks a lot once more Arun Kumar P</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;shareimprove <span class="keyword">this</span> answer</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;answered May 17 <a class="code" href="show__arp_8c.html#ab68d6cf1f426947b0d593919aa3a26ae">at</a> 5:52</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;user6343961</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;111</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        </div><div class="line"><a name="l00191"></a><span class="lineno"><a class="line" href="show__arp_8c.html#ab68d6cf1f426947b0d593919aa3a26ae">  191</a></span>&#160;Thanks <span class="keywordflow">for</span> the code, I used it as a base <span class="keywordflow">for</span> mine â€“ Mikko Korkalo Sep 2 <a class="code" href="show__arp_8c.html#ab68d6cf1f426947b0d593919aa3a26ae">at</a> 8:11</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;add a comment</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;up vote</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;0</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;down vote</div><div class="line"><a name="l00196"></a><span class="lineno"><a class="line" href="show__arp_8c.html#ae566e081312b0a9116f50bf8d560055c">  196</a></span>&#160;I took user6343961<span class="stringliteral">&#39;s code, did some cleaning and splicing and implemented support for automatically getting interface IP address. Also the parameters come from CLI instead of hardcoding. bind() is also used to get only ARP from the interface we want. Have fun. This code works for me.</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="stringliteral">#include &lt;sys/socket.h&gt;</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="stringliteral">#include &lt;sys/ioctl.h&gt;</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="stringliteral">#include &lt;asm/types.h&gt;</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="stringliteral">#include &lt;string.h&gt;</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="stringliteral">#include &lt;stdio.h&gt;</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="stringliteral">#include &lt;stdlib.h&gt;</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="stringliteral">#include &lt;unistd.h&gt;</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="stringliteral">#include &lt;linux/if_packet.h&gt;</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="stringliteral">#include &lt;linux/if_ether.h&gt;</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="stringliteral">#include &lt;linux/if_arp.h&gt;</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="stringliteral">#include &lt;arpa/inet.h&gt;  //htons etc</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="stringliteral">#define PROTO_ARP 0x0806</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="stringliteral">#define ETH2_HEADER_LEN 14</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="stringliteral">#define HW_TYPE 1</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="stringliteral">#define MAC_LENGTH 6</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="stringliteral">#define IPV4_LENGTH 4</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="stringliteral">#define ARP_REQUEST 0x01</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="stringliteral">#define ARP_REPLY 0x02</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="stringliteral">#define BUF_SIZE 60</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="stringliteral">#define debug(x...) printf(x);printf(&quot;\n&quot;);</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="stringliteral">#define info(x...) printf(x);printf(&quot;\n&quot;);</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="stringliteral">#define warn(x...) printf(x);printf(&quot;\n&quot;);</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="stringliteral">#define err(x...) printf(x);printf(&quot;\n&quot;);</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="stringliteral">struct arp_header {</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="stringliteral">    unsigned short hardware_type;</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="stringliteral">    unsigned short protocol_type;</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="stringliteral">    unsigned char hardware_len;</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="stringliteral">    unsigned char protocol_len;</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="stringliteral">    unsigned short opcode;</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="stringliteral">    unsigned char sender_mac[MAC_LENGTH];</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="stringliteral">    unsigned char sender_ip[IPV4_LENGTH];</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="stringliteral">    unsigned char target_mac[MAC_LENGTH];</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="stringliteral">    unsigned char target_ip[IPV4_LENGTH];</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="stringliteral">};</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="stringliteral">/*</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="stringliteral"> * Converts struct sockaddr with an IPv4 address to network byte order uin32_t.</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="stringliteral"> * Returns 0 on success.</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="stringliteral"> */</span></div><div class="line"><a name="l00240"></a><span class="lineno"><a class="line" href="show__arp_8c.html#a96ac6475a864d3d39c7adab43695edf3">  240</a></span>&#160;<span class="stringliteral">int int_ip4(struct sockaddr *addr, uint32_t *ip)</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="stringliteral">{</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="stringliteral">    if (addr-&gt;sa_family == AF_INET) {</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="stringliteral">        struct sockaddr_in *i = (struct sockaddr_in *) addr;</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="stringliteral">        *ip = i-&gt;sin_addr.s_addr;</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="stringliteral">        return 0;</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="stringliteral">    } else {</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="stringliteral">        err(&quot;Not AF_INET&quot;);</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="stringliteral">        return 1;</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="stringliteral">    }</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="stringliteral">}</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="stringliteral">/*</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="stringliteral"> * Formats sockaddr containing IPv4 address as human readable string.</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="stringliteral"> * Returns 0 on success.</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="stringliteral"> */</span></div><div class="line"><a name="l00256"></a><span class="lineno"><a class="line" href="show__arp_8c.html#a645d629c780b05ca545bedd2ce190da1">  256</a></span>&#160;<span class="stringliteral">int format_ip4(struct sockaddr *addr, char *out)</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="stringliteral">{</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="stringliteral">    if (addr-&gt;sa_family == AF_INET) {</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="stringliteral">        struct sockaddr_in *i = (struct sockaddr_in *) addr;</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="stringliteral">        const char *ip = inet_ntoa(i-&gt;sin_addr);</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="stringliteral">        if (!ip) {</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="stringliteral">            return -2;</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="stringliteral">        } else {</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="stringliteral">            strcpy(out, ip);</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="stringliteral">            return 0;</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="stringliteral">        }</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="stringliteral">    } else {</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="stringliteral">        return -1;</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="stringliteral">    }</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="stringliteral">}</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="stringliteral">/*</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="stringliteral"> * Writes interface IPv4 address as network byte order to ip.</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="stringliteral"> * Returns 0 on success.</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="stringliteral"> */</span></div><div class="line"><a name="l00276"></a><span class="lineno"><a class="line" href="show__arp_8c.html#a2592ab8da5459d850337eacf890c4163">  276</a></span>&#160;<span class="stringliteral">int get_if_ip4(int fd, const char *ifname, uint32_t *ip) {</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="stringliteral">    int err = -1;</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="stringliteral">    struct ifreq ifr;</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="stringliteral">    memset(&amp;ifr, 0, sizeof(struct ifreq));</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="stringliteral">    if (strlen(ifname) &gt; (IFNAMSIZ - 1)) {</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="stringliteral">        err(&quot;Too long interface name&quot;);</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="stringliteral">        goto out;</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="stringliteral">    }</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="stringliteral">    strcpy(ifr.ifr_name, ifname);</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="stringliteral">    if (ioctl(fd, SIOCGIFADDR, &amp;ifr) == -1) {</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="stringliteral">        perror(&quot;SIOCGIFADDR&quot;);</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="stringliteral">        goto out;</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="stringliteral">    }</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="stringliteral">    if (int_ip4(&amp;ifr.ifr_addr, ip)) {</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="stringliteral">        goto out;</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="stringliteral">    }</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="stringliteral">    err = 0;</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="stringliteral">out:</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="stringliteral">    return err;</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="stringliteral">}</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="stringliteral">/*</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="stringliteral"> * Sends an ARP who-has request to dst_ip</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="stringliteral"> * on interface ifindex, using source mac src_mac and source ip src_ip.</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="stringliteral"> */</span></div><div class="line"><a name="l00303"></a><span class="lineno"><a class="line" href="show__arp_8c.html#a8019df913e3731e072810835db179373">  303</a></span>&#160;<span class="stringliteral">int send_arp(int fd, int ifindex, const unsigned char *src_mac, uint32_t src_ip, uint32_t dst_ip)</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="stringliteral">{</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="stringliteral">    int err = -1;</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="stringliteral">    unsigned char buffer[BUF_SIZE];</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="stringliteral">    memset(buffer, 0, sizeof(buffer));</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="stringliteral">    struct sockaddr_ll socket_address;</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="stringliteral">    socket_address.sll_family = AF_PACKET;</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="stringliteral">    socket_address.sll_protocol = htons(ETH_P_ARP);</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="stringliteral">    socket_address.sll_ifindex = ifindex;</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="stringliteral">    socket_address.sll_hatype = htons(ARPHRD_ETHER);</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="stringliteral">    socket_address.sll_pkttype = (PACKET_BROADCAST);</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="stringliteral">    socket_address.sll_halen = MAC_LENGTH;</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="stringliteral">    socket_address.sll_addr[6] = 0x00;</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="stringliteral">    socket_address.sll_addr[7] = 0x00;</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="stringliteral">    struct ethhdr *send_req = (struct ethhdr *) buffer;</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="stringliteral">    struct arp_header *arp_req = (struct arp_header *) (buffer + ETH2_HEADER_LEN);</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="stringliteral">    int index;</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="stringliteral">    ssize_t ret, length = 0;</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="stringliteral">    //Broadcast</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="stringliteral">    memset(send_req-&gt;h_dest, 0xff, MAC_LENGTH);</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="stringliteral">    //Target MAC zero</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="stringliteral">    memset(arp_req-&gt;target_mac, 0x00, MAC_LENGTH);</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="stringliteral">    //Set source mac to our MAC address</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="stringliteral">    memcpy(send_req-&gt;h_source, src_mac, MAC_LENGTH);</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="stringliteral">    memcpy(arp_req-&gt;sender_mac, src_mac, MAC_LENGTH);</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="stringliteral">    memcpy(socket_address.sll_addr, src_mac, MAC_LENGTH);</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="stringliteral">    /* Setting protocol of the packet */</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="stringliteral">    send_req-&gt;h_proto = htons(ETH_P_ARP);</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="stringliteral">    /* Creating ARP request */</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="stringliteral">    arp_req-&gt;hardware_type = htons(HW_TYPE);</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="stringliteral">    arp_req-&gt;protocol_type = htons(ETH_P_IP);</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="stringliteral">    arp_req-&gt;hardware_len = MAC_LENGTH;</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="stringliteral">    arp_req-&gt;protocol_len = IPV4_LENGTH;</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="stringliteral">    arp_req-&gt;opcode = htons(ARP_REQUEST);</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="stringliteral">    debug(&quot;Copy IP address to arp_req&quot;);</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="stringliteral">    memcpy(arp_req-&gt;sender_ip, &amp;src_ip, sizeof(uint32_t));</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="stringliteral">    memcpy(arp_req-&gt;target_ip, &amp;dst_ip, sizeof(uint32_t));</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="stringliteral">    ret = sendto(fd, buffer, 42, 0, (struct sockaddr *) &amp;socket_address, sizeof(socket_address));</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="stringliteral">    if (ret == -1) {</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="stringliteral">        perror(&quot;sendto():&quot;);</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="stringliteral">        goto out;</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="stringliteral">    }</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="stringliteral">    err = 0;</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="stringliteral">out:</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="stringliteral">    return err;</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="stringliteral">}</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="stringliteral">/*</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="stringliteral"> * Gets interface information by name:</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="stringliteral"> * IPv4</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="stringliteral"> * MAC</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="stringliteral"> * ifindex</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="stringliteral"> */</span></div><div class="line"><a name="l00365"></a><span class="lineno"><a class="line" href="show__arp_8c.html#afd1aa73ea8101bfcee9f606444874de7">  365</a></span>&#160;<span class="stringliteral">int get_if_info(const char *ifname, uint32_t *ip, char *mac, int *ifindex)</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="stringliteral">{</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="stringliteral">    debug(&quot;get_if_info for %s&quot;, ifname);</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="stringliteral">    int err = -1;</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="stringliteral">    struct ifreq ifr;</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="stringliteral">    int sd = socket(AF_PACKET, SOCK_RAW, htons(ETH_P_ARP));</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="stringliteral">    if (sd &lt;= 0) {</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="stringliteral">        perror(&quot;socket()&quot;);</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="stringliteral">        goto out;</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="stringliteral">    }</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="stringliteral">    if (strlen(ifname) &gt; (IFNAMSIZ - 1)) {</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="stringliteral">        printf(&quot;Too long interface name, MAX=%i\n&quot;, IFNAMSIZ - 1);</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="stringliteral">        goto out;</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="stringliteral">    }</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="stringliteral">    strcpy(ifr.ifr_name, ifname);</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="stringliteral">    //Get interface index using name</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="stringliteral">    if (ioctl(sd, SIOCGIFINDEX, &amp;ifr) == -1) {</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="stringliteral">        perror(&quot;SIOCGIFINDEX&quot;);</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="stringliteral">        goto out;</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="stringliteral">    }</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="stringliteral">    *ifindex = ifr.ifr_ifindex;</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="stringliteral">    printf(&quot;interface index is %d\n&quot;, *ifindex);</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="stringliteral">    //Get MAC address of the interface</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="stringliteral">    if (ioctl(sd, SIOCGIFHWADDR, &amp;ifr) == -1) {</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="stringliteral">        perror(&quot;SIOCGIFINDEX&quot;);</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="stringliteral">        goto out;</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="stringliteral">    }</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="stringliteral">    //Copy mac address to output</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="stringliteral">    memcpy(mac, ifr.ifr_hwaddr.sa_data, MAC_LENGTH);</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="stringliteral">    if (get_if_ip4(sd, ifname, ip)) {</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="stringliteral">        goto out;</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="stringliteral">    }</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="stringliteral">    debug(&quot;get_if_info OK&quot;);</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="stringliteral">    err = 0;</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="stringliteral">out:</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="stringliteral">    if (sd &gt; 0) {</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="stringliteral">        debug(&quot;Clean up temporary socket&quot;);</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="stringliteral">        close(sd);</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="stringliteral">    }</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="stringliteral">    return err;</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="stringliteral">}</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="stringliteral">/*</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="stringliteral"> * Creates a raw socket that listens for ARP traffic on specific ifindex.</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="stringliteral"> * Writes out the socket&#39;</span>s FD.</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160; * Return 0 on success.</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160; */</div><div class="line"><a name="l00418"></a><span class="lineno"><a class="line" href="show__arp_8c.html#ad89ccaa92c72b69ca5394dc08dbc2483">  418</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="show__arp_8c.html#ad89ccaa92c72b69ca5394dc08dbc2483">bind_arp</a>(<span class="keywordtype">int</span> ifindex, <span class="keywordtype">int</span> *fd)</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;{</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <a class="code" href="show__arp_8c.html#a94158851b61c5208ed5551739a11b04d">debug</a>(<span class="stringliteral">&quot;bind_arp: ifindex=%i&quot;</span>, ifindex);</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keywordtype">int</span> ret = -1;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="comment">// Submit request for a raw socket descriptor.</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    *fd = socket(AF_PACKET, SOCK_RAW, htons(ETH_P_ARP));</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordflow">if</span> (*fd &lt; 1) {</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        perror(<span class="stringliteral">&quot;socket()&quot;</span>);</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        <span class="keywordflow">goto</span> out;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    }</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <a class="code" href="show__arp_8c.html#a94158851b61c5208ed5551739a11b04d">debug</a>(<span class="stringliteral">&quot;Binding to ifindex %i&quot;</span>, ifindex);</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="keyword">struct </span>sockaddr_ll sll;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    memset(&amp;sll, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_ll));</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    sll.sll_family = AF_PACKET;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    sll.sll_ifindex = ifindex;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="show__arp_8c.html#ae566e081312b0a9116f50bf8d560055c">bind</a>(*fd, (<span class="keyword">struct</span> sockaddr*) &amp;sll, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_ll)) &lt; 0) {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        perror(<span class="stringliteral">&quot;bind&quot;</span>);</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="keywordflow">goto</span> out;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    }</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    ret = 0;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;out:</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keywordflow">if</span> (ret &amp;&amp; *fd &gt; 0) {</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <a class="code" href="show__arp_8c.html#a94158851b61c5208ed5551739a11b04d">debug</a>(<span class="stringliteral">&quot;Cleanup socket&quot;</span>);</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        close(*fd);</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    }</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;}</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment"> * Reads a single ARP reply from fd.</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment"> * Return 0 on success.</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00453"></a><span class="lineno"><a class="line" href="show__arp_8c.html#a262b42f427c30edbfeeddf3b8ad0e515">  453</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="show__arp_8c.html#a262b42f427c30edbfeeddf3b8ad0e515">read_arp</a>(<span class="keywordtype">int</span> fd)</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;{</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <a class="code" href="show__arp_8c.html#a94158851b61c5208ed5551739a11b04d">debug</a>(<span class="stringliteral">&quot;read_arp&quot;</span>);</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="keywordtype">int</span> ret = -1;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buffer[<a class="code" href="show__arp_8c.html#a6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a>];</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    ssize_t length = recvfrom(fd, buffer, <a class="code" href="show__arp_8c.html#a6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a>, 0, NULL, NULL);</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keywordtype">int</span> index;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="keywordflow">if</span> (length == -1) {</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        perror(<span class="stringliteral">&quot;recvfrom()&quot;</span>);</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <span class="keywordflow">goto</span> out;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    }</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="keyword">struct </span>ethhdr *rcv_resp = (<span class="keyword">struct </span>ethhdr *) buffer;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keyword">struct </span><a class="code" href="structarp__header.html">arp_header</a> *arp_resp = (<span class="keyword">struct </span><a class="code" href="structarp__header.html">arp_header</a> *) (buffer + <a class="code" href="show__arp_8c.html#a9980fa59d6dce6b7e044ca6fc19b0936">ETH2_HEADER_LEN</a>);</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordflow">if</span> (ntohs(rcv_resp-&gt;h_proto) != <a class="code" href="show__arp_8c.html#a90d0f41f155e4b4ff63fda7627ac550c">PROTO_ARP</a>) {</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <a class="code" href="show__arp_8c.html#a94158851b61c5208ed5551739a11b04d">debug</a>(<span class="stringliteral">&quot;Not an ARP packet&quot;</span>);</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        <span class="keywordflow">goto</span> out;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    }</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keywordflow">if</span> (ntohs(arp_resp-&gt;<a class="code" href="structarp__header.html#a8c0824ace997e9dda49fb5116a02fc65">opcode</a>) != <a class="code" href="show__arp_8c.html#a06ba7b414e718081998f2814090debf1">ARP_REPLY</a>) {</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <a class="code" href="show__arp_8c.html#a94158851b61c5208ed5551739a11b04d">debug</a>(<span class="stringliteral">&quot;Not an ARP reply&quot;</span>);</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        <span class="keywordflow">goto</span> out;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    }</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <a class="code" href="show__arp_8c.html#a94158851b61c5208ed5551739a11b04d">debug</a>(<span class="stringliteral">&quot;received ARP len=%ld&quot;</span>, length);</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keyword">struct </span>in_addr sender_a;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    memset(&amp;sender_a, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> in_addr));</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    memcpy(&amp;sender_a.s_addr, arp_resp-&gt;<a class="code" href="structarp__header.html#acf457b77e1ea289ae333fd2287954758">sender_ip</a>, <span class="keyword">sizeof</span>(uint32_t));</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <a class="code" href="show__arp_8c.html#a94158851b61c5208ed5551739a11b04d">debug</a>(<span class="stringliteral">&quot;Sender IP: %s&quot;</span>, inet_ntoa(sender_a));</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <a class="code" href="show__arp_8c.html#a94158851b61c5208ed5551739a11b04d">debug</a>(<span class="stringliteral">&quot;Sender MAC: %02X:%02X:%02X:%02X:%02X:%02X&quot;</span>,</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;          arp_resp-&gt;<a class="code" href="structarp__header.html#abb59a40a80872088400763e1fd6acaf2">sender_mac</a>[0],</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;          arp_resp-&gt;<a class="code" href="structarp__header.html#abb59a40a80872088400763e1fd6acaf2">sender_mac</a>[1],</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;          arp_resp-&gt;<a class="code" href="structarp__header.html#abb59a40a80872088400763e1fd6acaf2">sender_mac</a>[2],</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;          arp_resp-&gt;<a class="code" href="structarp__header.html#abb59a40a80872088400763e1fd6acaf2">sender_mac</a>[3],</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;          arp_resp-&gt;<a class="code" href="structarp__header.html#abb59a40a80872088400763e1fd6acaf2">sender_mac</a>[4],</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;          arp_resp-&gt;<a class="code" href="structarp__header.html#abb59a40a80872088400763e1fd6acaf2">sender_mac</a>[5]);</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    ret = 0;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;out:</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;}</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment"> * Sample code that sends an ARP who-has request on</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment"> * interface &lt;ifname&gt; to IPv4 address &lt;ip&gt;.</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment"> * Returns 0 on success.</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00500"></a><span class="lineno"><a class="line" href="show__arp_8c.html#a1f9aa448e896d8e8069b96d99f02e1fc">  500</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="show__arp_8c.html#a1f9aa448e896d8e8069b96d99f02e1fc">test_arping</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *ifname, <span class="keyword">const</span> <span class="keywordtype">char</span> *ip) {</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="keywordtype">int</span> ret = -1;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    uint32_t dst = inet_addr(ip);</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keywordflow">if</span> (dst == 0 || dst == 0xffffffff) {</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        printf(<span class="stringliteral">&quot;Invalid source IP\n&quot;</span>);</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    }</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordtype">int</span> src;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keywordtype">int</span> ifindex;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keywordtype">char</span> mac[<a class="code" href="show__arp_8c.html#ac941b6796b26d46622ba39ad70667ed3">MAC_LENGTH</a>];</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="show__arp_8c.html#afd1aa73ea8101bfcee9f606444874de7">get_if_info</a>(ifname, &amp;src, mac, &amp;ifindex)) {</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <a class="code" href="show__arp_8c.html#a4499d2568fbc242c903a1729142882b1">err</a>(<span class="stringliteral">&quot;get_if_info failed, interface %s not found or no IP set?&quot;</span>, ifname);</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <span class="keywordflow">goto</span> out;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    }</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordtype">int</span> arp_fd;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="show__arp_8c.html#ad89ccaa92c72b69ca5394dc08dbc2483">bind_arp</a>(ifindex, &amp;arp_fd)) {</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        <a class="code" href="show__arp_8c.html#a4499d2568fbc242c903a1729142882b1">err</a>(<span class="stringliteral">&quot;Failed to bind_arp()&quot;</span>);</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="keywordflow">goto</span> out;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    }</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="show__arp_8c.html#a8019df913e3731e072810835db179373">send_arp</a>(arp_fd, ifindex, mac, src, dst)) {</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <a class="code" href="show__arp_8c.html#a4499d2568fbc242c903a1729142882b1">err</a>(<span class="stringliteral">&quot;Failed to send_arp&quot;</span>);</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <span class="keywordflow">goto</span> out;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    }</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="keywordflow">while</span>(1) {</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        <span class="keywordtype">int</span> r = <a class="code" href="show__arp_8c.html#a262b42f427c30edbfeeddf3b8ad0e515">read_arp</a>(arp_fd);</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        <span class="keywordflow">if</span> (r == 0) {</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;            <a class="code" href="show__arp_8c.html#ac710daf473358d346374ffdf21ba8f25">info</a>(<span class="stringliteral">&quot;Got reply, break out&quot;</span>);</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        }</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    }</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    ret = 0;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;out:</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keywordflow">if</span> (arp_fd) {</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        close(arp_fd);</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        arp_fd = 0;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    }</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;}</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno"><a class="line" href="show__arp_8c.html#a217dbf8b442f20279ea00b898af96f52">  543</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="show__arp_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span> **argv) {</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="keywordtype">int</span> ret = -1;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="keywordflow">if</span> (argc != 3) {</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        printf(<span class="stringliteral">&quot;Usage: %s &lt;INTERFACE&gt; &lt;DEST_IP&gt;\n&quot;</span>, argv[0]);</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    }</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *ifname = argv[1];</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *ip = argv[2];</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="show__arp_8c.html#a1f9aa448e896d8e8069b96d99f02e1fc">test_arping</a>(ifname, ip);</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;}</div><div class="ttc" id="show__arp_8c_html_a4499d2568fbc242c903a1729142882b1"><div class="ttname"><a href="show__arp_8c.html#a4499d2568fbc242c903a1729142882b1">err</a></div><div class="ttdeci">#define err(x...)</div></div>
<div class="ttc" id="structarp__header_html_acf457b77e1ea289ae333fd2287954758"><div class="ttname"><a href="structarp__header.html#acf457b77e1ea289ae333fd2287954758">arp_header::sender_ip</a></div><div class="ttdeci">unsigned char sender_ip[IPV4_LENGTH]</div><div class="ttdef"><b>Definition:</b> <a href="show__arp_8c_source.html#l00036">show_arp.c:36</a></div></div>
<div class="ttc" id="show__arp_8c_html_a9935c761f5e47454f667f0d5e4208e89"><div class="ttname"><a href="show__arp_8c.html#a9935c761f5e47454f667f0d5e4208e89">IPV4_LENGTH</a></div><div class="ttdeci">#define IPV4_LENGTH</div><div class="ttdef"><b>Definition:</b> <a href="show__arp_8c_source.html#l00023">show_arp.c:23</a></div></div>
<div class="ttc" id="show__arp_8c_html_a6821bafc3c88dfb2e433a095df9940c6"><div class="ttname"><a href="show__arp_8c.html#a6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a></div><div class="ttdeci">#define BUF_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="show__arp_8c_source.html#l00026">show_arp.c:26</a></div></div>
<div class="ttc" id="show__arp_8c_html_a8019df913e3731e072810835db179373"><div class="ttname"><a href="show__arp_8c.html#a8019df913e3731e072810835db179373">send_arp</a></div><div class="ttdeci">int send_arp(int fd, int ifindex, const unsigned char *src_mac, uint32_t src_ip, uint32_t dst_ip)</div><div class="ttdef"><b>Definition:</b> <a href="show__arp_8c_source.html#l00303">show_arp.c:303</a></div></div>
<div class="ttc" id="show__arp_8c_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="show__arp_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdef"><b>Definition:</b> <a href="show__arp_8c_source.html#l00041">show_arp.c:41</a></div></div>
<div class="ttc" id="show__arp_8c_html_a06ba7b414e718081998f2814090debf1"><div class="ttname"><a href="show__arp_8c.html#a06ba7b414e718081998f2814090debf1">ARP_REPLY</a></div><div class="ttdeci">#define ARP_REPLY</div><div class="ttdef"><b>Definition:</b> <a href="show__arp_8c_source.html#l00025">show_arp.c:25</a></div></div>
<div class="ttc" id="show__arp_8c_html_a94158851b61c5208ed5551739a11b04d"><div class="ttname"><a href="show__arp_8c.html#a94158851b61c5208ed5551739a11b04d">debug</a></div><div class="ttdeci">#define debug(x...)</div></div>
<div class="ttc" id="show__arp_8c_html_a90d0f41f155e4b4ff63fda7627ac550c"><div class="ttname"><a href="show__arp_8c.html#a90d0f41f155e4b4ff63fda7627ac550c">PROTO_ARP</a></div><div class="ttdeci">#define PROTO_ARP</div><div class="ttdef"><b>Definition:</b> <a href="show__arp_8c_source.html#l00018">show_arp.c:18</a></div></div>
<div class="ttc" id="show__arp_8c_html_a1f9aa448e896d8e8069b96d99f02e1fc"><div class="ttname"><a href="show__arp_8c.html#a1f9aa448e896d8e8069b96d99f02e1fc">test_arping</a></div><div class="ttdeci">int test_arping(const char *ifname, const char *ip)</div><div class="ttdef"><b>Definition:</b> <a href="show__arp_8c_source.html#l00500">show_arp.c:500</a></div></div>
<div class="ttc" id="structarp__header_html_a63496664c0728baa8b8f213864290325"><div class="ttname"><a href="structarp__header.html#a63496664c0728baa8b8f213864290325">arp_header::hardware_len</a></div><div class="ttdeci">unsigned char hardware_len</div><div class="ttdef"><b>Definition:</b> <a href="show__arp_8c_source.html#l00032">show_arp.c:32</a></div></div>
<div class="ttc" id="structarp__header_html_a26f790af15777120447eddb59c15bc7d"><div class="ttname"><a href="structarp__header.html#a26f790af15777120447eddb59c15bc7d">arp_header::hardware_type</a></div><div class="ttdeci">unsigned short hardware_type</div><div class="ttdef"><b>Definition:</b> <a href="show__arp_8c_source.html#l00030">show_arp.c:30</a></div></div>
<div class="ttc" id="show__arp_8c_html_ab68d6cf1f426947b0d593919aa3a26ae"><div class="ttname"><a href="show__arp_8c.html#ab68d6cf1f426947b0d593919aa3a26ae">at</a></div><div class="ttdeci">Thanks a lot once more Arun Kumar P shareimprove this answer answered May at</div><div class="ttdef"><b>Definition:</b> <a href="show__arp_8c_source.html#l00191">show_arp.c:191</a></div></div>
<div class="ttc" id="structarp__header_html_abb59a40a80872088400763e1fd6acaf2"><div class="ttname"><a href="structarp__header.html#abb59a40a80872088400763e1fd6acaf2">arp_header::sender_mac</a></div><div class="ttdeci">unsigned char sender_mac[MAC_LENGTH]</div><div class="ttdef"><b>Definition:</b> <a href="show__arp_8c_source.html#l00035">show_arp.c:35</a></div></div>
<div class="ttc" id="show__arp_8c_html_afd1aa73ea8101bfcee9f606444874de7"><div class="ttname"><a href="show__arp_8c.html#afd1aa73ea8101bfcee9f606444874de7">get_if_info</a></div><div class="ttdeci">int get_if_info(const char *ifname, uint32_t *ip, char *mac, int *ifindex)</div><div class="ttdef"><b>Definition:</b> <a href="show__arp_8c_source.html#l00365">show_arp.c:365</a></div></div>
<div class="ttc" id="structarp__header_html_a8c0824ace997e9dda49fb5116a02fc65"><div class="ttname"><a href="structarp__header.html#a8c0824ace997e9dda49fb5116a02fc65">arp_header::opcode</a></div><div class="ttdeci">unsigned short opcode</div><div class="ttdef"><b>Definition:</b> <a href="show__arp_8c_source.html#l00034">show_arp.c:34</a></div></div>
<div class="ttc" id="show__arp_8c_html_a262b42f427c30edbfeeddf3b8ad0e515"><div class="ttname"><a href="show__arp_8c.html#a262b42f427c30edbfeeddf3b8ad0e515">read_arp</a></div><div class="ttdeci">int read_arp(int fd)</div><div class="ttdef"><b>Definition:</b> <a href="show__arp_8c_source.html#l00453">show_arp.c:453</a></div></div>
<div class="ttc" id="show__arp_8c_html_ae566e081312b0a9116f50bf8d560055c"><div class="ttname"><a href="show__arp_8c.html#ae566e081312b0a9116f50bf8d560055c">bind</a></div><div class="ttdeci">Thanks a lot once more Arun Kumar P shareimprove this answer answered May I used it as a base for mine â€“ Mikko Korkalo Sep did some cleaning and splicing and implemented support for automatically getting interface IP address Also the parameters come from CLI instead of hardcoding bind()</div><div class="ttdef"><b>Definition:</b> <a href="show__arp_8c_source.html#l00196">show_arp.c:196</a></div></div>
<div class="ttc" id="structarp__header_html_a3b66dfb45363fee0dc6e5e1a6d6c5156"><div class="ttname"><a href="structarp__header.html#a3b66dfb45363fee0dc6e5e1a6d6c5156">arp_header::target_mac</a></div><div class="ttdeci">unsigned char target_mac[MAC_LENGTH]</div><div class="ttdef"><b>Definition:</b> <a href="show__arp_8c_source.html#l00037">show_arp.c:37</a></div></div>
<div class="ttc" id="structarp__header_html_a199abced9d3b3367a4ed4125e63ce9d4"><div class="ttname"><a href="structarp__header.html#a199abced9d3b3367a4ed4125e63ce9d4">arp_header::protocol_len</a></div><div class="ttdeci">unsigned char protocol_len</div><div class="ttdef"><b>Definition:</b> <a href="show__arp_8c_source.html#l00033">show_arp.c:33</a></div></div>
<div class="ttc" id="show__arp_8c_html_ac710daf473358d346374ffdf21ba8f25"><div class="ttname"><a href="show__arp_8c.html#ac710daf473358d346374ffdf21ba8f25">info</a></div><div class="ttdeci">#define info(x...)</div></div>
<div class="ttc" id="structarp__header_html_a7357fb5e2df0b32e297caf95618fcc73"><div class="ttname"><a href="structarp__header.html#a7357fb5e2df0b32e297caf95618fcc73">arp_header::target_ip</a></div><div class="ttdeci">unsigned char target_ip[IPV4_LENGTH]</div><div class="ttdef"><b>Definition:</b> <a href="show__arp_8c_source.html#l00038">show_arp.c:38</a></div></div>
<div class="ttc" id="structarp__header_html"><div class="ttname"><a href="structarp__header.html">arp_header</a></div><div class="ttdef"><b>Definition:</b> <a href="show__arp_8c_source.html#l00028">show_arp.c:28</a></div></div>
<div class="ttc" id="show__arp_8c_html_a364a315109bb526f2f773b5c4695e76b"><div class="ttname"><a href="show__arp_8c.html#a364a315109bb526f2f773b5c4695e76b">HW_TYPE</a></div><div class="ttdeci">#define HW_TYPE</div><div class="ttdef"><b>Definition:</b> <a href="show__arp_8c_source.html#l00020">show_arp.c:20</a></div></div>
<div class="ttc" id="show__arp_8c_html_a7a7c46ffaba30477b8c9e3e61bd2e106"><div class="ttname"><a href="show__arp_8c.html#a7a7c46ffaba30477b8c9e3e61bd2e106">ARP_REQUEST</a></div><div class="ttdeci">#define ARP_REQUEST</div><div class="ttdef"><b>Definition:</b> <a href="show__arp_8c_source.html#l00024">show_arp.c:24</a></div></div>
<div class="ttc" id="show__arp_8c_html_a9980fa59d6dce6b7e044ca6fc19b0936"><div class="ttname"><a href="show__arp_8c.html#a9980fa59d6dce6b7e044ca6fc19b0936">ETH2_HEADER_LEN</a></div><div class="ttdeci">#define ETH2_HEADER_LEN</div><div class="ttdef"><b>Definition:</b> <a href="show__arp_8c_source.html#l00019">show_arp.c:19</a></div></div>
<div class="ttc" id="structarp__header_html_a24dd89b1e5b9c31d4c2655df0d838673"><div class="ttname"><a href="structarp__header.html#a24dd89b1e5b9c31d4c2655df0d838673">arp_header::protocol_type</a></div><div class="ttdeci">unsigned short protocol_type</div><div class="ttdef"><b>Definition:</b> <a href="show__arp_8c_source.html#l00031">show_arp.c:31</a></div></div>
<div class="ttc" id="show__arp_8c_html_ac941b6796b26d46622ba39ad70667ed3"><div class="ttname"><a href="show__arp_8c.html#ac941b6796b26d46622ba39ad70667ed3">MAC_LENGTH</a></div><div class="ttdeci">#define MAC_LENGTH</div><div class="ttdef"><b>Definition:</b> <a href="show__arp_8c_source.html#l00022">show_arp.c:22</a></div></div>
<div class="ttc" id="show__arp_8c_html_ad89ccaa92c72b69ca5394dc08dbc2483"><div class="ttname"><a href="show__arp_8c.html#ad89ccaa92c72b69ca5394dc08dbc2483">bind_arp</a></div><div class="ttdeci">int bind_arp(int ifindex, int *fd)</div><div class="ttdef"><b>Definition:</b> <a href="show__arp_8c_source.html#l00418">show_arp.c:418</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="show__arp_8c.html">show_arp.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.12 </li>
  </ul>
</div>
</body>
</html>
